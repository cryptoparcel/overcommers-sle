
{% extends "base.html" %}
{% block content %}
<section class="section">
  <div class="container">

    {# ── Hero ── #}
    <div class="openings-hero fade-up">
      <p class="openings-hero__eyebrow">Current availability</p>
      <h1 class="openings-hero__title">Upcoming Openings</h1>
      <p class="openings-hero__lead">Tour first, apply when ready &mdash; we'll confirm fit and share pricing. Each home offers structured sober living with peer support.</p>
      <div class="openings-hero__stats">
        <div><span class="openings-hero__stat-value">10</span><span class="openings-hero__stat-label">Beds total</span></div>
        <div><span class="openings-hero__stat-value"><span class="pulse-dot"></span> 9</span><span class="openings-hero__stat-label">Available now</span></div>
        <div><span class="openings-hero__stat-value">April</span><span class="openings-hero__stat-label">Next move-in</span></div>
      </div>
    </div>

    {# ── Photo gallery ── #}
    {% set photos = [
      ('exterior-front.jpg', 'Front of house'),
      ('backyard-deck.png', 'Backyard deck'),
      ('bedroom-upstairs.png', 'Upstairs bedroom'),
      ('bedroom-shared.png', 'Shared bedroom'),
      ('bedroom-bunk.png', 'Bedroom with bunks'),
      ('bedroom-private.png', 'Private room'),
      ('backyard-lawn.png', 'Backyard'),
      ('bathroom-full.jpg', 'Full bathroom'),
      ('bathroom-half.jpg', 'Half bathroom')
    ] %}
    <div class="gallery fade-up d1">
      {% for fname, label in photos[:5] %}
        <div class="gallery__item{{ ' gallery__item--hero' if loop.index0 == 0 else '' }}" onclick="openLightbox({{ loop.index0 }})">
          <img src="{{ url_for('static', filename='assets/photos/' + fname) }}" alt="{{ label }}" loading="{{ 'eager' if loop.index0 == 0 else 'lazy' }}">
          {% if loop.index0 == 4 and photos|length > 5 %}
            <div class="gallery__more">+{{ photos|length - 5 }} more</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    {# ── Lightbox ── #}
    <div class="lb" id="lightbox">
      <button class="lb__close" onclick="closeLightbox()" aria-label="Close">&times;</button>
      <div class="lb__counter"><span id="lbCurrent">1</span> / {{ photos|length }}</div>
      <div class="lb__stage" id="lbStage">
        {% for fname, label in photos %}
          <div class="lb__slide" data-index="{{ loop.index0 }}">
            <img src="{{ url_for('static', filename='assets/photos/' + fname) }}" alt="{{ label }}">
            <div class="lb__caption">{{ label }}</div>
          </div>
        {% endfor %}
        <button class="lb__nav lb__nav--prev" onclick="navLightbox(-1)" aria-label="Previous">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <button class="lb__nav lb__nav--next" onclick="navLightbox(1)" aria-label="Next">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>
      <div class="lb__thumbs">
        {% for fname, label in photos %}
          <div class="lb__thumb{{ ' active' if loop.index0 == 0 else '' }}" onclick="goToSlide({{ loop.index0 }})">
            <img src="{{ url_for('static', filename='assets/photos/' + fname) }}" alt="">
          </div>
        {% endfor %}
      </div>
    </div>

    {# ── Active listings ── #}
    {% if openings and openings|length > 0 %}
      {% for o in openings %}
      <div class="listing fade-up d2">
        <div class="listing__body">
          <div class="listing__badge"><span class="pulse-dot"></span> Accepting deposits</div>
          <h2 class="listing__title">{{ o.title }}</h2>
          <div class="listing__meta">
            {% if o.city %}<span class="listing__tag">{{ o.city }}{% if o.state %}, {{ o.state }}{% endif %}</span>{% endif %}
            {% if o.available_on %}<span class="listing__tag">Available {{ o.available_on.strftime('%b %Y') }}</span>{% endif %}
            <span class="listing__tag">{{ o.beds_available }} bed{{ 's' if o.beds_available != 1 else '' }} open</span>
          </div>
          {% if o.summary %}
            <p class="listing__desc">{{ o.summary }}</p>
          {% else %}
            <p class="listing__desc">Safe, structured sober living with shared rooms, house meetings, and peer accountability. Vaulted wood-beam ceilings, full kitchen, private backyard with deck, and a supportive community focused on your next chapter.</p>
          {% endif %}

          <div class="listing__includes">
            <span class="listing__incl-item"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Furnished bed</span>
            <span class="listing__incl-item"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> All utilities</span>
            <span class="listing__incl-item"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Wi-Fi</span>
            <span class="listing__incl-item"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Weekly meetings</span>
            <span class="listing__incl-item"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Peer support</span>
            <span class="listing__incl-item"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Laundry</span>
          </div>

          <div class="listing__price">
            {% if not o.hide_price and o.price_monthly %}
              <strong>{{ o.price_monthly }}</strong>{% if o.deposit %} + {{ o.deposit }}{% endif %}
            {% else %}
              <strong>$1,000/month</strong> + $1,000 refundable deposit
            {% endif %}
            <a class="listing__price-help" href="{{ url_for('public.contact') }}">Need help with costs? Let's talk</a>
          </div>
          <div class="listing__actions">
            <a class="btn btn--primary" href="{{ url_for('public.opening_detail', slug=o.slug) }}">View details</a>
            <a class="btn" href="{{ url_for('public.tour') }}">Schedule a tour</a>
            <a class="btn btn--accent" href="{{ url_for('public.deposit') }}">Pay deposit</a>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="listing fade-up d2">
        <div class="listing__body">
          <h3 class="h3">No openings posted right now</h3>
          <p class="muted">Apply anyway and we'll reach out when a spot opens. Or sign up below to get notified.</p>
          <div class="listing__actions">
            <a class="btn btn--primary" href="{{ url_for('public.apply') }}">Apply</a>
            <a class="btn" href="{{ url_for('public.contact') }}">Contact us</a>
          </div>
        </div>
      </div>

      {# Interest signup #}
      <div class="card" style="margin-top:16px;">
        <div class="card__body">
          <h3 class="h3">Get notified when a spot opens</h3>
          <form method="post" action="{{ url_for('public.interest_post') }}" novalidate style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;margin-top:8px;">
            {{ interest_form.hidden_tag() }}
            <div class="field" style="flex:1;min-width:220px;">
              {{ interest_form.email(class_="input", placeholder="Your email address", autocomplete="email") }}
            </div>
            <button class="btn btn--primary" type="submit">Notify me</button>
          </form>
          <p class="muted small" style="margin-top:6px;">We'll only email you about openings. No spam.</p>
        </div>
      </div>
    {% endif %}

    {# ── What to expect your first week ── #}
    <div class="first-week fade-up d3">
      <h3 class="first-week__title">What to expect your first week</h3>
      <p class="first-week__sub">Moving somewhere new is hard. Here's how we make it easier.</p>
      <div class="first-week__grid">
        <div class="first-week__day">
          <div class="first-week__day-label">Day 1</div>
          <div class="first-week__day-text">Move in, meet your housemates, get a tour of the home and neighborhood. We help you settle in.</div>
        </div>
        <div class="first-week__day">
          <div class="first-week__day-label">Days 2 &ndash; 3</div>
          <div class="first-week__day-text">Establish your routine. We'll walk through house expectations, chore schedules, and meeting times together.</div>
        </div>
        <div class="first-week__day">
          <div class="first-week__day-label">Days 4 &ndash; 7</div>
          <div class="first-week__day-text">Start connecting with local resources &mdash; meetings, employment support, and community. You're not doing this alone.</div>
        </div>
      </div>
    </div>

    {# ── Coming soon: Home B ── #}
    <div class="coming-soon fade-up d4">
      <div class="coming-soon__badge">Coming soon</div>
      <h2 class="coming-soon__title">Grover Beach &mdash; Home B</h2>
      <p class="coming-soon__meta">Grover Beach, CA &middot; Opening 2026</p>
      <p class="coming-soon__desc">A second structured home is being prepared. Same standards, same support. Get notified when it opens.</p>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
        <a class="btn btn--primary" href="{{ url_for('public.contact') }}?subject=Home+B+Interest">Get notified</a>
        <a class="btn" href="{{ url_for('public.tour') }}">Tour Home A</a>
      </div>
    </div>

    {# ── Need help now ── #}
    <div class="helpline fade-up">
      <div class="helpline__icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
      </div>
      <div class="helpline__text">
        <p class="helpline__title">Not sure where to start?</p>
        <p class="helpline__desc">Call us directly &mdash; no commitment, no judgment. We'll help you figure out next steps.</p>
      </div>
      <div class="helpline__actions">
        <a class="btn btn--primary btn--sm" href="tel:+18052028473">Call (805) 202-8473</a>
        <a class="btn btn--sm" href="{{ url_for('public.contact') }}">Send a message</a>
      </div>
    </div>

    {# ── Crisis resources ── #}
    <div class="crisis fade-up">
      <button class="crisis__toggle" id="crisisToggle" aria-expanded="false">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        If we're not the right fit, we still want to help. View crisis &amp; support resources.
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="margin-left:auto"><polyline points="6 9 12 15 18 9"/></svg>
      </button>
      <div class="crisis__body" id="crisisBody">
        <div class="crisis__grid">
          <a class="crisis__item" href="tel:988">
            <div class="crisis__item-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3"/></svg></div>
            <div><div class="crisis__item-text">988 Suicide &amp; Crisis Lifeline</div><div class="crisis__item-sub">Call or text 988 &mdash; free, 24/7</div></div>
          </a>
          <a class="crisis__item" href="tel:18006624357">
            <div class="crisis__item-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></div>
            <div><div class="crisis__item-text">SAMHSA Helpline</div><div class="crisis__item-sub">1-800-662-4357 &mdash; free referrals, 24/7</div></div>
          </a>
          <a class="crisis__item" href="tel:18007997233">
            <div class="crisis__item-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
            <div><div class="crisis__item-text">Veterans Crisis Line</div><div class="crisis__item-sub">1-800-273-8255, press 1</div></div>
          </a>
          <a class="crisis__item" href="tel:211">
            <div class="crisis__item-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
            <div><div class="crisis__item-text">211 &mdash; Local Help</div><div class="crisis__item-sub">Shelters, food, and services near you</div></div>
          </a>
        </div>
      </div>
    </div>

    {# ── Hope message ── #}
    <div class="hope fade-up">
      <div class="hope__line"></div>
      <p class="hope__text">Recovery is possible. If you're reading this, you've already taken the first step.</p>
    </div>

    {# ── Help card ── #}
    <div class="help-card fade-up">
      <p>Questions about availability, pricing, or the process? <a href="{{ url_for('public.contact') }}">Contact us</a> or read the <a href="{{ url_for('public.guide') }}">resident guide</a>.</p>
    </div>

  </div>
</section>
{% endblock %}
